name: Test

on:
  push:
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-18.04

    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 5

      - name: Check Github env
        run: |
          echo github.event_name: ${{ github.event_name }}
          echo github.ref: ${{ github.ref }}
          echo github.sha: ${{ github.sha }}
          echo github.event.before: ${{ github.event.before }}

      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"

      - name: git log
        run: |
          git log -n 5

      - uses: dorny/paths-filter@v2
        id: changes
        with:
          list-files: 'csv'
          filters: |
            any:
              - '**'

      - name: Show changes
        run: |
          echo ${{ steps.changes.outputs.any_files }}

  verify:
    runs-on: ubuntu-18.04

    strategy:
      matrix:
        problem: [pA, pB, pC]

    steps:
      - uses: actions/checkout@v2

      - name: Install tps
        run: |
          git clone --depth 1 https://github.com/ioi-2017/tps.git
          cd tps && sudo ./install-tps.sh

      - name: Verify ${{ matrix.problem }}
        working-directory: ${{ matrix.problem }}
        run: |
          tps verify
